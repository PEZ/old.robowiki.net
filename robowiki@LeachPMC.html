<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML><HEAD><TITLE>LeachPMC - Robo Wiki -= Collecting Robocode Knowledge =-</TITLE>
<META NAME='KEYWORDS' CONTENT='Leach, PMC'/>
<LINK REL="stylesheet" HREF="/robodocs/wiki.css">
</HEAD><BODY BGCOLOR="white">
<div class=wikiheader><h1><a href="robowiki@Robo_Home"><img src="/images/RoboWiki.png" alt="[Home]" border=0 align="right"></a><a href="robowiki@back=LeachPMC">LeachPMC</a></h1><a href="robowiki@Robo_Home" class=wikipagelink>Robo Home</a> | <a href="robowiki@Changes" class=wikipagelink>Changes</a> | <a href="robowiki@action=editprefs">Preferences</a> | <a href='?action=index'>AllPages</a><br>
<hr class=wikilineheader></div><div class=wikitext><a href="robowiki@PEZ" class=wikipagelink>PEZ</a>s entry in the <a href="robowiki@PatternMatcherChallenge" class=wikipagelink>PatternMatcherChallenge</a>
<p>
Download it from: <a rel="nofollow" href="https://robocoderepository.com/BotDetail.jsp@id=1548">https://robocoderepository.com/BotDetail.jsp?id=1548</a>
<p>
Version 1.2 might be the final version. I suddenly found myself consdidering adding quite ridiculous things to this bot in order to get the highest <a href="robowiki@PatternMatcherChallenge/PMCIndex" class=wikipagelink>PMC index</a>. But I stop here and am satisfied with 1.2 getting 101.15% with <a href="robowiki@PatternMatching" class=wikipagelink>PatternMatching</a> only. I'm creating a new bot with this pattern matcher. It'll live on this page: <a href="robowiki@Frankie" class=wikipagelink>Frankie</a>.
<hr noshade class=wikiline size=1>
<H4>Log</H4>

<UL >
<li> The code released as open source: <a href="robowiki@LeachPMC/Code" class=wikipagelink>/Code</a>
<li> Version 1.2      Extended the pattern with info if it's from the pre-pattern phase or not. Matches from the beginning of the pattern in the first half of the round and from the end in the second half.
<li> Version 1.1.10 Tweaked gun alignment check (now aims the gun immediately after firing).
<li> Version 1.1.9 Got rid of most of those stray bullets by waiting for the gun to align before fire
<li> Version 1.1.7 <a href="robowiki@Vic" class=wikipagelink>Vic</a> pointed my attention to the finer details of the projection phase...
<li> Version 1.1.6 Saving pattern data between matches.
<li> Version 1.1.5 Tighter scanner. Bug fix in the search code made my skipped turn counter go from 797 to 9 in a 100 round match.
<li> Version 1.1.4 Interpolates missed scan ticks. Doesn't match or project between rounds.
<li> Version 1.1.3 Uses a variable length search vector (max 12500 frames) and a huge (25000 frames) pattern space.
<li> Version 1.1.2 Extends the search vector to 1000 ticks. Somtimes finds matches as long as 300+ against <a href="robowiki@PatternBot" class=wikipagelink>PatternBot</a>.
<li> Version 1.1.1 uses "traditional" (Eh, like <a href="robowiki@MogBot" class=wikipagelink>MogBot</a>) measures for matching and projection. That is "heading delta" and velocity. A high performance matching makes this a really fast bot even though it searches for vectors as large as 200 in a pattern space of 10k. I might extend the search vector, but I'm not sure that would give any extra edge, since most rounds are 300 ticks or so. (In the real world outside the PMC lab that is.)
</UL>
<p>
<hr noshade class=wikiline size=1>
<H4>The evolution of a <a href="robowiki@PatternMatching" class=wikipagelink>PatternMatching</a> gun</H4>

<TABLE CELLSPACING='0' CELLPADDING='1' BORDER='1'>
<TR VALIGN='CENTER' ><td colspan='0.5'><strong><a href="robowiki@LeachPMC" class=wikipagelink>LeachPMC</a> version</strong>___</td><td colspan="0.5"><strong>Bullet damage</strong>_</td><td colspan="0.5"><em><strong>Index</strong></em></td></TR>
<TR VALIGN='CENTER' ><td align="left" colspan='0.5'>1.1.2                           </td><td align="left" colspan="0.5">18638               </td><td colspan="0.5">101.15%</td></TR>
<TR VALIGN='CENTER' ><td align="left" colspan='0.5'>1.1.10                         </td><td align="left" colspan="0.5">18638               </td><td colspan="0.5">100.96%</td></TR>
<TR VALIGN='CENTER' ><td align="left" colspan='0.5'>1.1.9                           </td><td align="left" colspan="0.5">18735               </td><td colspan="0.5">101.01%</td></TR>
<TR VALIGN='CENTER' ><td align="left" colspan='0.5'>1.1.7                           </td><td align="left" colspan="0.5">18180               </td><td colspan="0.5">100.01%</td></TR>
<TR VALIGN='CENTER' ><td align="left" colspan='0.5'>1.1.6                           </td><td align="left" colspan="0.5">18443               </td><td colspan="0.5">099.85%</td></TR>
<TR VALIGN='CENTER' ><td align="left" colspan='0.5'>1.1.5                           </td><td align="left" colspan="0.5">17978               </td><td colspan="0.5">099.30%</td></TR>
<TR VALIGN='CENTER' ><td align="left" colspan='0.5'>1.1.4                           </td><td align="left" colspan="0.5">18035               </td><td colspan="0.5">098.88%</td></TR>
<TR VALIGN='CENTER' ><td align="left" colspan='0.5'>1.1.4                           </td><td align="left" colspan="0.5">08938               </td><td colspan="0.5">069.24%</td></TR>
<TR VALIGN='CENTER' ><td align="left" colspan='0.5'>1.1.3                           </td><td align="left" colspan="0.5">08758               </td><td colspan="0.5">N/A</td></TR>
<TR VALIGN='CENTER' ><td align="left" colspan='0.5'>1.1.2                           </td><td align="left" colspan="0.5">08350               </td><td colspan="0.5">N/A </td></TR>
<TR VALIGN='CENTER' ><td align="left" colspan='0.5'>1.1.1                           </td><td align="left" colspan="0.5">08154               </td><td colspan="0.5">N/A</td></TR>
<TR VALIGN='CENTER' ><td align="left" colspan='0.5'>1.1                              </td><td align="left" colspan="0.5">04500               </td><td colspan="0.5">N/A</td></TR>
<TR VALIGN='CENTER' ><td align="left" colspan='0.5'>1.0                              </td><td align="left" colspan="0.5">01783               </td><td colspan="0.5">N/A</td></TR>
</TABLE>
<p>
<hr noshade class=wikiline size=1>
<H4>Questions/comments</H4>

<p>
Your making real progress here PEZ! You won't be needing Albert's gun anymore ;-) Of course i was only joking about this before. Actually i think pattern matching like what we are doing for the challenge is of little use against the unpredictable movement of the top bots. But it sure is fun watching all those bullet dodgers and oscillators get bashed hard! -- <a href="robowiki@Vic" class=wikipagelink>Vic</a>
<p>
Thanks! I'm not as sure as you are about these guns being useless against unpredictable movement. Well, true unpredictability maybe, but no robot has achieved that yet. There are quite a few pattern matchers in the top 30 of <a href="robowiki@EternalRumble" class=wikipagelink>EternalRumble</a>. -- <a href="robowiki@PEZ" class=wikipagelink>PEZ</a>
<p>
I tend to agree, also, alot of flatteners find their weakness not in a better stat gun, but against pattern matchers. I think his refusal to include any pm might be the biggest thing that'll bring down <a href="robowiki@Paul_Evans" class=wikipagelink>Paul Evans</a>. -- <a href="robowiki@Kuuran" class=wikipagelink>Kuuran</a>
<p>
That's interesting ... maybe there's a glimmer of hope for <a href="robowiki@Ender" class=wikipagelink>Ender</a> yet :-) You guys have much more experience against the top bots so i had better take your word for it :-) --<a href="robowiki@Vic" class=wikipagelink>Vic</a>
<hr noshade class=wikiline size=1>
I've reached a limitation now, where it seems I can't tweak my bot over the 100% index line. This is a call for help! My bot seems to loose the rounds because it sometimes shoot stray bullets. Especially when <a href="robowiki@PatternBot" class=wikipagelink>PatternBot</a> drives laterally and away and changes lateral direction (I believe I have observed this anyway). I guess it finds the wrong pattern or something. How do you do it? I always look for the longest pattern, starting from index 0 of the pattern. Maybe a search backwards instead? One more question. In the data written by <a href="robowiki@LeachPMC" class=wikipagelink>LeachPMC</a> I see that velocity never has any decimals. I guess that's pretty reasonable given the tick-time in the game. But I've never seen a mention of this I think. Have you? Where? -- <a href="robowiki@PEZ" class=wikipagelink>PEZ</a>
<p>
I assume you are not talking about the initial stage but about the true pattern movement stage, because the initial stage cannot be accurately predicted using pattern matching. Are you rounding off any data before putting it in the buffer? Especially (delta)heading needs good accuracy. It's also quite possible (as is the case with <a href="robowiki@EnderPMC" class=wikipagelink>EnderPMC</a>) that you have actually already perfected the Matcher part (you pattern searching seems ok) but have minute flaws in what you call the Projection part. This is very hard to debug (as i am finding out right now with <a href="robowiki@EnderPMC" class=wikipagelink>EnderPMC</a>). If you find the gunbearing using a predicted point then you could use <a href="robowiki@RobocodeGLV014" class=wikipagelink>RobocodeGLV014</a> to see if your bullet really exactly hits the point that you aimed for. If all else fails, hardcode hitting <a href="robowiki@PatternBot" class=wikipagelink>PatternBot</a> in its initial movement stage and I'm sure you'll beat it with your current Index value (I wonder if our PMC king <a href="robowiki@Rozu" class=wikipagelink>Rozu</a> has done that...). You are right that <a href="robowiki@PatternBot" class=wikipagelink>PatternBot</a> had no velocity values with decimals. Looking back <a href="robowiki@PatternBot" class=wikipagelink>PatternBot</a> would have been even harder to beat if i had put in some strange velocity values. Actually there are a lot of things i could have done to make it harder to beat but this is challenging enough i'd say.....maybe in another challenge :-) -- <a href="robowiki@Vic" class=wikipagelink>Vic</a>
<UL >
<li> That's an entirely correct assumption. I'll deal with the opening shots separately when the actual pattern matching is to my liking. Unfortunately <a href="robowiki@RobocodeGLV014" class=wikipagelink>RobocodeGLV014</a> doesn't run on my machine... You have no idea how often I have wanted to use it. -- <a href="robowiki@PEZ" class=wikipagelink>PEZ</a>
<li> On the subject of velocity granularity. I assumed it was a Robocode thing. In fact I still assume that. There's only so much one can do to control the velocity and since 100% of the measures are without decimals...  -- <a href="robowiki@PEZ" class=wikipagelink>PEZ</a>
</UL>
I just downloaded <a href="robowiki@LeachPMC" class=wikipagelink>LeachPMC</a> 1.1.61. It looks to me that you have two seperate issues here. 1: Sometimes there's a huge freak miss. I think that must be a matching bug. 2: Your aim is not entirely accurate, which sometimes results in juuuuuuuust missing <a href="robowiki@PatternBot" class=wikipagelink>PatternBot</a>. It looks like when you miss that the bullet is always behind <a href="robowiki@PatternBot" class=wikipagelink>PatternBot</a>, so maybe... a) you didn't take into account that you fire always one tick later then your final aim... b) your projection pattern is one tick to short... c) as i said before maybe you don't store the data accurately enough. --<a href="robowiki@Vic" class=wikipagelink>Vic</a>
<UL >
<li> Thanks for checking it. I have spotted the same two issues, but failed to produce a theroy. I tested against Walls and there it is very obvious that I'm behind with my projection. The data is stored as accurately as I read the (doubles)  so it shouldn't be the problem. I have not taken into account the thing with firing one tick later. Wasn't even aware of it. Must check how to adjust for that. You gave me lots of clues. Thanks! -- <a href="robowiki@PEZ" class=wikipagelink>PEZ</a>
<UL >
<li> I adjusted the projection phase. Not exactly like "a"or "b" above, but it helped a lot. Now <a href="robowiki@LeachPMC" class=wikipagelink>LeachPMC</a> wins 40% of the rounds! Assuming I have now fixed the projection bug, I can chase the matching glitch and maybe then fry <a href="robowiki@PatternBot" class=wikipagelink>PatternBot</a>. =) -- <a href="robowiki@PEZ" class=wikipagelink>PEZ</a>
<li> It turns out my matching wasn't to blame. It was my gun that sometimes wasn't pointing at the projection point when firing. Now I get 50/50 in survival and 101.01% in bullet damage index, but <a href="robowiki@PatternBot" class=wikipagelink>PatternBot</a> wins from it's ram damage bonus. I must try deal with the pre-pattern phase now. <a href="robowiki@Vic" class=wikipagelink>Vic</a>, what do you do here? Anyone else have any reasonably simple ideas of how grab some more hits here? I'm uploading version 1.1.9 in a jiffy so anyone curious can see what I do wrong. -- <a href="robowiki@PEZ" class=wikipagelink>PEZ</a> 
<li> <a href="robowiki@EnderPMC" class=wikipagelink>EnderPMC</a> starts with <a href="robowiki@LinearTargeting" class=wikipagelink>LinearTargeting</a>, then <a href="robowiki@FixedPointTargeting" class=wikipagelink>FixedPointTargeting</a>, then <a href="robowiki@HeadOnTargeting" class=wikipagelink>HeadOnTargeting</a> and finally goes to <a href="robowiki@PatternMatching" class=wikipagelink>PatternMatching</a>. In the initial stage it tests every tick if it will hit <a href="robowiki@PatternBot" class=wikipagelink>PatternBot</a>. If not, it will move on to the next targeting method. --<a href="robowiki@Vic" class=wikipagelink>Vic</a>
</UL>
</UL>
<p>
Whoah! I can't believe <a href="robowiki@LeachPMC" class=wikipagelink>LeachPMC</a> 1.1.9 gets over 101% Index while not beating <a href="robowiki@PatternBot" class=wikipagelink>PatternBot</a>! (did you run more than one match?) That probably means that if you get that initial damage going you'll end up with a huge index! Good work <a href="robowiki@PEZ" class=wikipagelink>PEZ</a>! -- <a href="robowiki@Vic" class=wikipagelink>Vic</a>
<p>
=) Yes, but it was a close shave. And now I might have fixed it. (Or it is maybe just that I just need some luck to actually beat <a href="robowiki@PatternBot" class=wikipagelink>PatternBot</a>). Out of ideas on how to attack the pre-pattern-phase though. Anyone has their ideas flowing? <a href="robowiki@Kawigi" class=wikipagelink>Kawigi</a>? You seem completely unable to stop your flood of ideas (pun unintended). -- <a href="robowiki@PEZ" class=wikipagelink>PEZ</a>
<p>
I would also need to read and write zipped movement data I think. This is how I read and write today:<pre>
    private void saveMovie(String enemyName) {
        try {
            PrintStream out = new PrintStream(new RobocodeFileOutputStream(getDataFile(enemyName)));
            for (int i = 0; i &lt; Math.min(movieSize, PM_LENGTH / 3); i++) {
                Frame frame = (Frame)movie.get(i);
                out.println(frame.headingDelta);
                out.println(frame.velocity);
            }
            out.flush();
            out.close();
        }
        catch (Exception e) {
            System.out.println("Error saving movie: " + e);
        }
    }

    private void restoreMovie(String enemyName) {
        try {
            BufferedReader in = new BufferedReader(new
                FileReader(getDataFile(enemyName)));
            String line;
            do {
                line = in.readLine();
                if (line != null) {
                    double headingDelta = Double.parseDouble(line);
                    line = in.readLine();
                    double velocity = Double.parseDouble(line);
                    record(headingDelta, velocity, 1);
                }
            } while (line != null);
            in.close();
        }
        catch (Exception e) {
            System.out.println("Error restoring movie: " + e);
        }
    }
</pre>
I would like if I could use the same idiom (with println() and readLine()) because I .. well I like it! =) I can't seem to wrap my mind around Java's IO design. I have tried several ways to create a BufferedReader<a href="robowiki@action=edit&id=BufferedReader" class=wikipageedit>?</a> from a Zip-stream, but utterly failed. I think I might have had working versions of the writing, but I'm not sure. -- <a href="robowiki@PEZ" class=wikipagelink>PEZ</a>
<p>
Streams and Readers don't like each other that much - use an InputStreamReader<a href="robowiki@action=edit&id=InputStreamReader" class=wikipageedit>?</a> or OutputStreamWriter<a href="robowiki@action=edit&id=OutputStreamWriter" class=wikipageedit>?</a> in between to maybe make it work.  -- <a href="robowiki@Kawigi" class=wikipagelink>Kawigi</a>
<p>
<a href="robowiki@PEZ" class=wikipagelink>PEZ</a>, i posted some clues on initial damage on this page earlier. Maybe you missed it. On the IO issue, yeah, i had the same problem. I eventually settled for a BufferedInputStream<a href="robowiki@action=edit&id=BufferedInputStream" class=wikipageedit>?</a> and wrote my own version of readLine. -- <a href="robowiki@Vic" class=wikipagelink>Vic</a>
<p>
Thanks Vic! Though now I am hoping that <a href="robowiki@Kawigi" class=wikipagelink>Kawigi</a> will show me that it is possible with that InputStreamReader<a href="robowiki@action=edit&id=InputStreamReader" class=wikipageedit>?</a>. Please? About your initial phase handling, it obviously works great. But I want to solve it with <a href="robowiki@PatternMatching" class=wikipagelink>PatternMatching</a> and, if possible, in a way that is generally useful instead of tweaked against <a href="robowiki@PatternBot" class=wikipagelink>PatternBot</a>. I'm testing an idea right now and will let you know what idea it is and if it works or not once I have the test results. -- <a href="robowiki@PEZ" class=wikipagelink>PEZ</a>
<UL >
<li> Well it didn't work all that good. My idea was to include in my pattern if it was from the initial phase or not. That would make me only match those patterns in that phase and avoid matching those patterns in the rest of the round. I still miss too much when the bots start far away from each other. Tried to compensate for that too, but I'm not sure I'm doing it right. Well, things didn't get worse anyways. =) -- <a href="robowiki@PEZ" class=wikipagelink>PEZ</a>
</UL>
<p>
For the ZipInputStream<a href="robowiki@action=edit&id=ZipInputStream" class=wikipageedit>?</a>, you can just create the stream, initialize it (the whole nextEntry thingy), and then do something like:
<pre>
	BufferedReader in = new BufferedReader(new InputStreamReader(zipin));
</pre>
...and you should be all set.  It might work better if you also do this when you write the file - initialize your ZipOutputStream<a href="robowiki@action=edit&id=ZipOutputStream" class=wikipageedit>?</a>, and then use a PrintWriter<a href="robowiki@action=edit&id=PrintWriter" class=wikipageedit>?</a> instead of a PrintStream<a href="robowiki@action=edit&id=PrintStream" class=wikipageedit>?</a>:
<pre>
	PrintWriter out = new PrintWriter(new OutputStreamWriter(zipout));
</pre>
...of course, you may find that writing with a stream and reading with a reader works fine (its writing with a writer and reading with a stream that might have issues, because streams weren't written with readers/writers in mind). -- <a href="robowiki@Kawigi" class=wikipagelink>Kawigi</a>
<p>
Many thanks Kawigi! It works great! Now I can save the full "movie". The size dropped from 170k to 4k! =) The code now looks like so:<pre>
    private void saveMovie(String enemyName) {
        try {
            ZipOutputStream zipout = new ZipOutputStream(new RobocodeFileOutputStream(getDataFile(enemyName + ".zip")));
            zipout.putNextEntry(new ZipEntry(enemyName));
            PrintWriter out = new PrintWriter(new OutputStreamWriter(zipout)); 
            for (int i = 0; i &lt; Math.min(movieSize, PM_LENGTH); i++) {
                Frame frame = (Frame)movie.get(i);
                out.println(frame.headingDelta);
                out.println(frame.velocity);
                out.println(frame.isInitialPhase ? "1" : "0");
            }
            out.flush();
            out.close();
        }
        catch (Exception e) {
            System.out.println("Error saving movie: " + e);
        }
    }

    private void restoreMovie(String enemyName) {
        try {
            ZipInputStream zipin = new ZipInputStream(new FileInputStream(getDataFile(enemyName + ".zip")));
            zipin.getNextEntry();
            BufferedReader in = new BufferedReader(new InputStreamReader(zipin));
            String line;
            do {
                line = in.readLine();
                if (line != null) {
                    double headingDelta = Double.parseDouble(line);
                    line = in.readLine();
                    double velocity = Double.parseDouble(line);
                    line = in.readLine();
                    boolean initialFlag = (Integer.parseInt(line) == 1 ? true : false);
                    record(headingDelta, velocity, 1, initialFlag);
                }
            } while (line != null);
            in.close();
        }
        catch (Exception e) {
            System.out.println("Error restoring movie: " + e);
        }
    }
</pre>
The alert reader also can see that I have kept the idea with including "initial phase" info in the movie. It seems to work a little better with it than without. -- <a href="robowiki@PEZ" class=wikipagelink>PEZ</a>
<p>
Thanks Kawigi! That will help clean up my code :-) I better remove my solution from this page since it is completely useless now. --<a href="robowiki@Vic" class=wikipagelink>Vic</a>
</div><hr class=wikilinefooter>
<div class=wikifooter><form method="post" action="robowiki" enctype="application/x-www-form-urlencoded">
<a href="robowiki@Robo_Home" class=wikipagelink>Robo Home</a> | <a href="robowiki@Changes" class=wikipagelink>Changes</a> | <a href="robowiki@action=editprefs">Preferences</a> | <a href='?action=index'>AllPages</a><br>
<a href="robowiki@action=edit&id=LeachPMC" class=wikipageedit>Edit text of this page</a> | <a href="robowiki@action=history&id=LeachPMC">View other revisions</a><br>Last edited August 12, 2003 22:29 EST by <a href="robowiki@PEZ" title="ID 1052 from 192.168.0.xxx">PEZ</a> <a href="robowiki@action=browse&diff=1&id=LeachPMC">(diff)</a><br>Search: <input type="text" name="search"  size="20" /><input type="hidden" name="dosearch" value="1"  /></form></div>
</body>
</html>